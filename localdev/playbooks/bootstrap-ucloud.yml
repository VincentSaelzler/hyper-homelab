- name: Install required packages.
  hosts: ucloud
  become: yes
  tasks:
  - name: Update cache and upgrade existing packages.
    apt:
      upgrade: dist
      cache_valid_time: 3600
  - name: Install new apt packages.
    apt:
      state: present
      pkg:
        - tasksel
        - ubuntu-desktop-minimal
        - xrdp
  - name: Install new snap packages.
    snap:
      classic: yes
      state: present
      name: code
  - name: Reboot system if required.
    command:
      cmd: shutdown -r now 'Rebooting to complete system upgrade'
      removes: /var/run/reboot-required
      