---
# some of the stuff here is ubuntu-specific.
- name: Update Packages and Sync Time
  hosts: vagrantboxes
  become: yes
  tasks:
  - name: Set Timezone
    community.general.timezone:
      name: America/New_York
  - name: Start and Enable systemd-timesyncd
    service:
      name: systemd-timesyncd.service
      enabled: yes
      state: started
  - name: Upgrade Packages
    apt:
      upgrade: dist
      update_cache: yes
  - name: Reboot System if Required
    command:
      cmd: shutdown -r now 'Rebooting to complete system upgrade'
      removes: /var/run/reboot-required

- name: Add User and SSH Keys
  hosts: vagrantboxes
  become: yes
  tasks:
  - name: Add the User Vince
    user:
      name: vince
      comment: Vincent Saelzler
      password: '$6$samplesalt$4go7Bx4d0ZawOzbfKqAPjDiiS6yde8WJ/WUL8I6jq7ERU8MsLzluPPIpvpV8Y1RSeslZxNFeSVCsYWpkfZBX.1'
      shell: /bin/bash
  - name: Set Authorized (Public) Key
    authorized_key:
      user: vince
      state: present
      key: "{{ lookup('file', '~/.ssh/id_rsa_ansible.pub') }}"
  - name: Ensure .ssh Directory Exists.
    file: 
      dest: "{{ '/home/vince/.ssh/id_rsa' | dirname }}"
      mode: 0700
      owner: vince
      state: directory
  - name: Install SSH Private Key
    copy:
      src: ~/.ssh/id_rsa_ansible
      dest: /home/vince/.ssh/id_rsa
      mode: 0600
      owner: vince
