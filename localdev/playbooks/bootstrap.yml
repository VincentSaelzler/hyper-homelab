---
# some of the stuff here is ubuntu-specific.
- name: Bootstrap a VM
  hosts: vagrantboxes
  become: yes
  tasks:
  - name: Set Timezone
    community.general.timezone:
      name: America/New_York
  - name: Start and Enable systemd-timesyncd
    service:
      name: systemd-timesyncd.service
      enabled: yes
      state: started
  - name: Set Authorized Key
    authorized_key:
      user: vagrant
      state: present
      key: "{{ lookup('file', '../../id_rsa_ansible.pub') }}"
  - name: Upgrade Packages
    apt:
      upgrade: dist
      update_cache: yes
  - name: Reboot System if Required
    command:
      cmd: shutdown -r now 'Rebooting to complete system upgrade'
      removes: /var/run/reboot-required